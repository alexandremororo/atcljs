<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Consulta de Lojas</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #16a34a;
      --bg: #0b1215;
      --card: #0f171b;
      --ring: #22c55e;
      --fg: #e5e7eb;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 24px;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, #0b1215 0%, #0b1215 50%, #0d1418 100%);
      color: var(--fg);
    }

    a {
      color: var(--accent);
      text-decoration: none;
    }

    .container {
      max-width: clamp(320px, 94vw, 1140px);
      margin: 0 auto;
      padding: 0 16px;
    }

    /* Título */
    .titulo-centro {
      text-align: center;
      margin-top: 40px;
    }

    .titulo-centro h1 {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
      font-size: clamp(24px, 4vw, 36px);
      font-weight: 800;
      margin: 0;
    }

    .titulo-centro .sub {
      color: #94a3b8;
      font-size: 15px;
      margin-top: 10px;
      margin-bottom: 20px;
    }

    /* Painel */
    .panel {
      background: rgba(15, 23, 27, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 16px;
      padding: 24px;
      max-width: 1140px;
      margin: 0 auto 32px auto;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.45);
      transition: box-shadow 0.4s ease;
    }

    .panel:hover {
      box-shadow: 0 0 0 2px rgba(238, 104, 14, 0.4), 0 10px 24px rgba(238, 104, 14, 0.3);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(5px);
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    @media (min-width: 760px) {
      .grid {
        grid-template-columns: 220px 1fr 1fr 1fr;
      }
    }

    label {
      font-size: 12px;
      color: #9ca3af;
      display: block;
      margin-bottom: 6px;
    }

    input,
    select {
      width: 100%;
      background: #0b1215;
      color: #e5e7eb;
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 12px;
      padding: 10px 12px;
      outline: none;
    }

    input:focus,
    select:focus {
      border-color: var(--ring);
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.15);
    }

    .actions {
      display: flex;
      gap: 10px;
      align-items: end;
      flex-wrap: wrap;
    }

    button {
      appearance: none;
      border: none;
      background: var(--accent);
      color: #081014;
      font-weight: 800;
      padding: 12px 16px;
      border-radius: 12px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    button:hover {
      background-color: #1f2937;
      transform: scale(1.03);
    }

    button:active {
      transform: translateY(1px);
    }

    .btn-ghost {
      background: transparent;
      color: #cbd5e1;
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .meta {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
      color: #9ca3af;
      font-size: 12px;
    }

    /* Resultados */
    .results {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }

    @media (min-width: 760px) {
      .results {
        grid-template-columns: 1fr 1fr;
      }
    }

    /* Card */
    .card {
      display: inline-block;
      width: 100%;
      padding: 24px;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(18, 25, 30, .95), rgba(14, 19, 22, .95));
      border: 1px solid rgba(255, 255, 255, 0.06);
      transition: transform .3s ease, box-shadow .3s ease;
      opacity: 0;
      transform: translateY(10px);
      animation: fadeIn .4s ease forwards;
    }

    .card:hover {
      transform: scale(1.04);
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .card header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      margin: -24px -24px 12px -24px;
    }

    .card header>div {
      display: flex;
      align-items: baseline;
      gap: 6px;
      flex: 1 1 auto;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
    }

    .card header>div strong {
      font-size: 14px;
      font-weight: 800;
      letter-spacing: -0.02em;
      text-transform: uppercase;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.2;
    }

    .card header>div .count {
      white-space: nowrap;
      line-height: 1;
      flex-shrink: 0;
    }

    .card header .tag {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: #86efac;
      color: #0b1410;
      font-size: 11px;
      font-weight: 800;
      height: 24px;
      padding: 0 10px;
      min-width: 34px;
      border-radius: 6px;
      line-height: 1;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .card .body {
      padding: 12px 16px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }

    .row {
      display: grid;
      grid-template-columns: minmax(96px, 120px) 1fr;
      gap: 12px;
      align-items: start;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      padding: 8px 0;
    }

    .row:last-child {
      border-bottom: 0;
    }

    .k {
      color: #9ca3af;
      font-size: 13px;
      line-height: 1.2;
    }

    .v {
      font-weight: 350;
      line-height: 1.25;
      word-break: break-word;
      overflow-wrap: anywhere;
    }

    .v.-num {
      white-space: nowrap;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }

    .v.-num::-webkit-scrollbar {
      display: none;
    }

    /* Desktop apenas: alinhar baseline e manter a linha no último item */
    @media (min-width: 760px) {
      .card .body>.row {
        align-items: baseline;
        /* alinha "Início de Operação" com a data */
      }

      .card .body>.row:last-child {
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        /* força a linha final */
      }
    }

    /* Rodapé */
    footer {
      margin-top: 24px;
      font-size: 12px;
      color: #94a3b8;
      text-align: center;
    }

    /* ===== MOBILE (≤480px) — tudo relacionado a mobile fica aqui ===== */
    @media (max-width: 480px) {

      /* Layout geral */
      .container {
        padding: 0 12px;
      }

      .results {
        display: flex;
        flex-direction: column;
        gap: 16px;
        align-items: stretch;
      }

      /* Card: linhas (rótulo + valor) */
      .card .body>.row {
        align-items: baseline;
        /* alinha “Início de Operação” com a data */
        /* se quiser empilhar rótulo acima do valor, descomente:
    grid-template-columns: 1fr;
    gap: 6px;
    */
      }

      /* Mobile: exibe a linha também no último item (desktop fica sem) */
      .card .body>.row:last-child {
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      }

      /* Tipografia mobile */
      .card .body>.row .k {
        font-size: 12px;
        line-height: 1.25;
        white-space: nowrap;
        /* evita quebra de rótulos longos */
      }

      .card .body>.row .v {
        font-size: 14px;
        line-height: 1.3;
        white-space: nowrap;
        /* simetria: sem quebra */
        overflow: hidden;
        text-overflow: ellipsis;
        /* “…” quando passar */
        cursor: pointer;
        /* dica visual p/ “tap to reveal” */
      }

      .card .body>.row .v.-num {
        font-variant-numeric: tabular-nums;
      }

      /* “Tap to reveal”: ao tocar, remove ellipsis e libera scroll horizontal */
      .card .body>.row .v.-reveal {
        overflow-x: auto;
        overflow-y: hidden;
        text-overflow: clip;
        /* sem reticências */
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }

      .card .body>.row .v.-reveal::-webkit-scrollbar {
        display: none;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="titulo-centro">
      <h1>
        Consulta de Lojas
        <a href="index.html"><img src="atacadao.png" alt="Atacadão" id="logo"
            style="max-height:44px;vertical-align:middle;"></a>
      </h1>
      <div class="sub">Pesquise por CNPJ, Código da Loja, ou filtre por Regional/Tipo de Serviço.</div>
    </div>

    <div class="panel panel-center">
      <div class="grid">
        <div>
          <label for="tipoBusca">Buscar por</label>
          <select id="tipoBusca">
            <option value="cnpj">CNPJ</option>
            <option value="cod">Código (Loja)</option>
            <option value="filial">Filial (nome)</option>
          </select>
        </div>

        <div>
          <label for="valorBusca">Valor</label>
          <input id="valorBusca" type="text" placeholder="Ex.: 75.315.333/0001-00 ou 123" />
        </div>

        <div>
          <label for="atividade">Tipo de Serviço</label>
          <select id="atividade" name="atividade">
            <option value="">Todos</option>
            <option value="AT">AT</option>
            <option value="CD">CD</option>
            <option value="AS">AS</option>
          </select>
        </div>

        <div>
          <label for="regionalFiltro">Regional</label>
          <select id="regionalFiltro">
            <option value="">Todas</option>
          </select>
        </div>

        <div class="actions">
          <button id="btnBuscar">Buscar</button>
          <button id="btnLimpar" class="btn-ghost">Limpar</button>
        </div>
      </div>

      <div class="meta"><span id="qtd"></span><span id="dica" class="count"></span></div>
    </div>

    <div id="resultado" class="results"></div>

    <footer>Gerado automaticamente a partir de <strong>Atacadão Inaugurações</strong>. @ 2025 - Manutenção | Última
      Atualização dia 18/10/2025.</footer>
  </div>

  <!-- datalist do autocomplete de filial -->
  <datalist id="sugestoesFilial"></datalist>

  <script>
    // --- Dados embutidos ---
    // --- dados externos: substitui o antigo "const REGISTROS = [...]" ---
let REGISTROS = []; // será preenchido pelo fetch

(async function carregarDadosLoja() {
  try {
    const resp = await fetch('dados_lojas.json', { cache: 'no-store' });
    if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
    const dados = await resp.json();

    // mapa de normalização das regionais (mantive o mesmo mapeamento sugerido)
    const MAP = {
      "DR-SP CAPITAL": "SPC", "DR-SP INTERIOR": "SPI", "DR-SC": "SC", "DR-RS": "RS", "DR-PR": "PR",
      "DR-DF/GO": "DF/GO", "DR-MS": "MS", "DR-MT": "MT", "DR-BA/SE": "BA/SE", "DR-RJ/ES": "RJ/ES",
      "DR-NO": "NO", "DR-CE": "CE", "DR-PE": "PE", "DR-MG": "MG",
      "DIR-SP CAPITAL": "SPC", "DIR-SP INTERIOR": "SPI", "DIR-SC": "SC", "DIR-RS": "RS", "DIR-PR": "PR",
      "DIR-DF/GO": "DF/GO", "DIR-MS": "MS", "DIR-MT": "MT", "DIR-BA/SE": "BA/SE", "DIR-RJ/ES": "RJ/ES",
      "DIR-NO": "NO", "DIR-CE": "CE", "DIR-PE": "PE", "DIR-MG": "MG"
    };

    const normalizar = s => String(s || "")
      .toUpperCase()
      .replace(/\s+/g, " ")
      .replace(/\s*-\s*/g, "-")
      .trim();

    REGISTROS = Array.isArray(dados)
      ? dados.map(r => ({ ...r, regional: MAP[normalizar(r.regional)] || r.regional }))
      : [];

    // mantém o funcionamento original (se as funções existirem)
    if (typeof preencherRegionais === "function") preencherRegionais();
    if (typeof populaSugestoesFilial === "function") populaSugestoesFilial();
    if (typeof render === "function") render(REGISTROS.slice(0, 4));
    if (typeof toggleAutocompletePorTipo === "function") toggleAutocompletePorTipo();

  } catch (err) {
    console.error('Erro ao carregar dados_loja.json', err);
    // não altera UI; apenas loga o erro para depuração
  }
})();

    // === Atualiza SOMENTE "regional" nos dados embutidos ===
    (function atualizarRegionais() {
      const MAP = {
        "DR-SP CAPITAL": "SPC", "DR-SP INTERIOR": "SPI", "DR-SC": "SC", "DR-RS": "RS", "DR-PR": "PR",
        "DR-DF/GO": "DF/GO", "DR-MS": "MS", "DR-MT": "MT", "DR-BA/SE": "BA/SE", "DR-RJ/ES": "RJ/ES",
        "DR-NO": "NO", "DR-CE": "CE", "DR-PE": "PE", "DR-MG": "MG",
        "DIR-SP CAPITAL": "SPC", "DIR-SP INTERIOR": "SPI", "DIR-SC": "SC", "DIR-RS": "RS", "DIR-PR": "PR",
        "DIR-DF/GO": "DF/GO", "DIR-MS": "MS", "DIR-MT": "MT", "DIR-BA/SE": "BA/SE", "DIR-RJ/ES": "RJ/ES",
        "DIR-NO": "NO", "DIR-CE": "CE", "DIR-PE": "PE", "DIR-MG": "MG"
      };
      const norm = s => String(s || "").toUpperCase().replace(/\s+/g, " ").replace(/\s*-\s*/g, "-").trim();
      if (Array.isArray(REGISTROS)) {
        for (const r of REGISTROS) {
          const k = norm(r.regional);
          if (MAP[k]) r.regional = MAP[k];
        }
      }
    })();
    /* ====================== RENDERIZAÇÃO INICIAL ====================== */
    // Mostra as 4 primeiras lojas ao carregar a página

    function renderizarLojasIniciais() {
      const container = document.getElementById("resultado"); // onde os cards aparecem
      container.innerHTML = ""; // limpa os resultados atuais

      REGISTROS.slice(0, 4).forEach((registro) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
      <strong>${registro.filial}</strong> • COD ${registro.cod}<br>
      <span>${registro.uf} - CNPJ ${registro.cnpj}</span>
    `;
        container.appendChild(card);
      });
    }

    /* ====================== REFS ====================== */
    const resultado = document.getElementById("resultado");
    const tipoBusca = document.getElementById("tipoBusca");
    const valorBusca = document.getElementById("valorBusca");
    const atividadeFiltro = document.getElementById("atividade");
    const regionalFiltro = document.getElementById("regionalFiltro");
    const qtd = document.getElementById("qtd");
    const dica = document.getElementById("dica");
    const btnBuscar = document.getElementById("btnBuscar");
    const btnLimpar = document.getElementById("btnLimpar");
    const dataList = document.getElementById("sugestoesFilial");

    /* ====================== UTILS ====================== */
    const normaliza = s => (s || '').toString().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    const soDigitos = s => (s || '').toString().replace(/\D/g, '');
    const escapeHtml = str => String(str)
      .replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;')
      .replaceAll('"', '&quot;').replaceAll("'", '&#39;');

    function formatarDataBR(dt) {
      if (!dt) return null;
      const raw = String(dt).trim().split(' ')[0];
      const [yyyy, mm, dd] = raw.split('-');
      if (yyyy && mm && dd) return `${dd.padStart(2, '0')}/${mm.padStart(2, '0')}/${yyyy}`;
      const d = new Date(dt); if (isNaN(d)) return null;
      return d.toLocaleDateString('pt-BR');
    }

    function matchRegistro(r, chave, needle) {
      const n = normaliza(needle);
      if (!n) return true;
      switch (chave) {
        case 'cnpj': return soDigitos(r.cnpj).includes(soDigitos(needle));
        case 'cod': return ((r.cod || '').toString().replace(/\D/g, '') === soDigitos(needle));
        case 'filial': return normaliza(r.filial).includes(n);
        default: return false;
      }
    }

    // Ler o mesmo campo do card para serviço
    function getTipoServicoCodigo(r) {
      const bruto = r?.ativ ?? r?.inicioOperacao ?? r?.tipoServico ?? r?.tipo_servico ?? '';
      const s = String(bruto).trim().toUpperCase();           // "AT", "AS", "CD" ou "AT - Atacado"
      const m = s.match(/\b(AT|AS|CD)\b/);
      return m ? m[1] : s;
    }
    function lerServicoSelecionado(sel) {
      const raw = (sel?.value || '').trim().toUpperCase();
      if (!raw || normaliza(raw) === 'todos') return '';
      const m = raw.match(/\b(AT|AS|CD)\b/);
      return m ? m[1] : raw;
    }
    function lerRegionalSelecionada(sel) {
      const v = (sel?.value || '').trim();
      return v && normaliza(v) !== 'todas' ? v : '';
    }
    const getRegionalTag = r => ((r.regional || '') + '').trim().toUpperCase() || '-';

    /* ====================== POPULAR REGIONAIS ====================== */
function preencherRegionais() {
  const regionais = Array.from(new Set(
    REGISTROS.map(r => (r.regional || '').toString().trim())
  )).filter(Boolean).sort((a, b) => a.localeCompare(b, 'pt-BR'));

  regionalFiltro.innerHTML = '<option value="">Todos</option>'; // limpa antes de preencher

  for (const reg of regionais) {
    const opt = document.createElement('option');
    opt.value = reg;
    opt.textContent = reg;
    regionalFiltro.appendChild(opt);
  }
}

    /* ====================== AUTOCOMPLETE FILIAL (por Regional) ====================== */
    function populaSugestoesFilial() {
      if (!dataList) return;
      const reg = lerRegionalSelecionada(regionalFiltro);
      const nomes = Array.from(new Set(
        REGISTROS
          .filter(r => reg ? (normaliza(r.regional || '') === normaliza(reg)) : true)
          .map(r => (r.filial || '').toString().trim())
          .filter(Boolean)
      )).sort((a, b) => a.localeCompare(b, 'pt-BR'));
      dataList.innerHTML = '';
      for (const nome of nomes) {
        const opt = document.createElement('option');
        opt.value = nome;
        dataList.appendChild(opt);
      }

      /* ====================== AUTOCOMPLETE SOMENTE NÚMEROS) ====================== */
      valorBusca.addEventListener('input', () => {
        if (tipoBusca.value === 'filial') {
          valorBusca.value = valorBusca.value.replace(/[^a-zA-ZÀ-ÿ\s]/g, '');
        }
      });
    }
    function toggleAutocompletePorTipo() {
      if (tipoBusca.value === 'filial') {
        valorBusca.setAttribute('list', 'sugestoesFilial');
        populaSugestoesFilial();
      } else {
        valorBusca.removeAttribute('list');
        if (dataList) dataList.innerHTML = '';
      }
    }

    /* ====================== RENDER ====================== */
    function row(k, v) {
      const vv = (v === undefined || v === null || v === '')
        ? '<span class="empty">—</span>' : escapeHtml(String(v));
      const key = String(k).toLowerCase();
      const isNum = /(cnpj|cep|inscr|inscrição|inscr\. estadual|ie)/.test(key);
      const cls = 'v' + (isNum ? ' -num' : '');
      return `<div class="row"><div class="k">${k}</div><div class="${cls}">${vv}</div></div>`;
    }
    function render(lista) {
      resultado.innerHTML = '';
      qtd.textContent = lista.length ? `${lista.length} resultado(s)` : '';
      for (const r of lista) {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <header>
            <div><strong>${escapeHtml(r.filial || 'Filial')}</strong> <span class="count">• COD ${escapeHtml(r.cod ?? '-')}</span></div>
            <span class="tag">${escapeHtml(getRegionalTag(r))}</span>
          </header>
          <div class="body">
            ${row('CNPJ', r.cnpj)}
            ${row('Razão Social', r.razaoSocial || '-')}
            ${row('Inscr. Estadual', r.inscricaoEstadual || r.inscrest || '-')}
            ${row('Endereço', r.endereco || '-')}
            ${row('Bairro', r.bairro || '-')}
            ${row('Cidade', r.cidade || '-')}
            ${row('CEP', r.cep || '-')}
            ${row('Regional', (r.regional || '-').toString().toUpperCase())}
            ${row('UF', r.estado || r.uf || '-')}
            ${row('Tipo de Serviço', r.ativ || r.inicioOperacao || '-')}
            ${row('Início de Operação', formatarDataBR(r.iniciovenda) || '-')}
          </div>
        `;
        resultado.appendChild(card);
      }
    }

    function filtrar() {
      const chave = tipoBusca.value;
      const texto = (valorBusca.value || '').trim();
      const serv = lerServicoSelecionado(atividadeFiltro);   // "" ou AT/AS/CD
      const regional = lerRegionalSelecionada(regionalFiltro);   // "" ou DR-...

      let lista = [];

      // Validação e busca por código da loja
      if (chave === 'cod' && texto) {
        const c = soDigitos(texto);
        if (c.length > 3) {
          dica.textContent = 'O código da loja deve conter exatamente 3 números.';
          dica.style.textAlign = 'center';
          render([]);
          return;
        }
        const exatos = REGISTROS.filter(r =>
          ((r.cod || '').toString().replace(/\D/g, '') === c) &&
          (serv ? getTipoServicoCodigo(r) === serv : true)
        );
        if (exatos.length) {
          lista = [exatos[0]];
        }
      }

      // Validação e busca por CNPJ
      else if (chave === 'cnpj' && texto) {
        const cnpj = soDigitos(texto);
        if (cnpj.length === 0 || cnpj.length > 14) {
          dica.textContent = 'O CNPJ deve conter até 14 números.';
          dica.style.textAlign = 'center';
          render([]);
          return;
        }
        let base = regional
          ? REGISTROS.filter(r => normaliza(r.regional || '') === normaliza(regional))
          : REGISTROS;

        lista = base.filter(r =>
          matchRegistro(r, chave, texto) &&
          (serv ? getTipoServicoCodigo(r) === serv : true)
        );
      }

      // Busca padrão para outros tipos
      else {
        let base = regional
          ? REGISTROS.filter(r => normaliza(r.regional || '') === normaliza(regional))
          : REGISTROS.filter(r => texto ? matchRegistro(r, chave, texto) : true);

        lista = serv ? base.filter(r => getTipoServicoCodigo(r) === serv) : base;
      }

      // Mensagens de feedback
      if (lista.length === 0) {
        if (texto || serv || regional) {
          dica.textContent =
            `Nenhuma loja encontrada${texto ? ` para "${texto}"` : ''}` +
            `${regional ? ' na regional ' + regional.toUpperCase() : ''}` +
            `${serv ? ' com atividade ' + serv : ''}.`;
          dica.style.textAlign = 'center';
        } else {
          dica.textContent = '';
          dica.style.textAlign = 'left';
        }
      } else {
        dica.textContent = '';
        dica.style.textAlign = 'left';
      }

      render(lista);
    }

    /* ====================== LISTENERS ====================== */
    tipoBusca.addEventListener('change', () => {
      valorBusca.value = '';
      render(REGISTROS.slice(0, 4));
      toggleAutocompletePorTipo();
    });


    valorBusca.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); filtrar(); } });
    btnBuscar.addEventListener('click', (e) => { e.preventDefault(); filtrar(); });
    btnLimpar.addEventListener('click', () => {
      tipoBusca.selectedIndex = 0;
      valorBusca.value = '';
      atividadeFiltro.selectedIndex = 0;
      regionalFiltro.selectedIndex = 0;
      dica.textContent = ''; qtd.textContent = '';
      render(REGISTROS.slice(0, 4));
      toggleAutocompletePorTipo();
    });

    valorBusca.addEventListener('input', () => {
      const tipo = tipoBusca.value;

      if (tipo === 'cnpj') {
        let v = valorBusca.value.replace(/\D/g, '').slice(0, 14);

        // Aplica máscara se tiver os 14 dígitos
        if (v.length === 14) {
          v = v.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})$/, '$1.$2.$3/$4-$5');
        }
        valorBusca.value = v;
      }
    });
    valorBusca.addEventListener('change', () => { if (tipoBusca.value === 'filial') filtrar(); });
    valorBusca.addEventListener('input', () => {
      if (tipoBusca.value === 'filial') {
        const val = (valorBusca.value || '').trim().toLowerCase();
        const has = REGISTROS.some(r => (r.filial || '').toString().trim().toLowerCase() === val);
        if (has) filtrar();
      }

      valorBusca.addEventListener('input', () => {
        const tipo = tipoBusca.value;
        let v = valorBusca.value.replace(/\D/g, '').slice(0, 14);

        if (tipo === 'cnpj') {
          // Aplica máscara progressiva enquanto digita
          if (v.length >= 3 && v.length <= 5)
            v = v.replace(/^(\d{2})(\d{1,3})/, '$1.$2');
          else if (v.length > 5 && v.length <= 8)
            v = v.replace(/^(\d{2})(\d{3})(\d{1,3})/, '$1.$2.$3');
          else if (v.length > 8 && v.length <= 12)
            v = v.replace(/^(\d{2})(\d{3})(\d{3})(\d{1,4})/, '$1.$2.$3/$4');
          else if (v.length > 12)
            v = v.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{1,2})/, '$1.$2.$3/$4-$5');

          valorBusca.value = v;
        } else if (tipo === 'cod') {
          valorBusca.value = v.slice(0, 3);
        }
      });
    });
    regionalFiltro.addEventListener('change', () => { if (tipoBusca.value === 'filial') populaSugestoesFilial(); filtrar(); });
    atividadeFiltro.addEventListener('change', filtrar);

    valorBusca.addEventListener('input', () => {
      const tipo = tipoBusca.value;

      if (tipo === 'cnpj') {
        valorBusca.value = valorBusca.value.replace(/\D/g, '').slice(0, 14);
      } else if (tipo === 'cod') {
        valorBusca.value = valorBusca.value.replace(/\D/g, '').slice(0, 3);
      }
    });

    // Clique em valores longos → rola para o fim
    resultado.addEventListener('click', (e) => {
      const el = e.target.closest(".v");
      if (!el) return;
      el.style.setProperty('white-space', 'nowrap', 'important');
      el.style.setProperty('overflow-x', 'auto', 'important');
      el.style.setProperty('overflow-y', 'hidden', 'important');
      el.style.setProperty('text-overflow', 'clip', 'important');
      el.style.setProperty('word-break', 'normal', 'important');
      el.style.setProperty('-webkit-overflow-scrolling', 'touch');
      el.style.scrollbarWidth = 'none';
      el.style.msOverflowStyle = 'none';
      requestAnimationFrame(() => { el.scrollLeft = el.scrollWidth; });
    });

    /* ====================== INICIAL ====================== */
    render(REGISTROS.slice(0, 4));
    toggleAutocompletePorTipo();

    // Aviso se abrir via file:// (opcional)
    if (window.location.protocol === 'file:') {
      console.warn("[Aviso] Abrindo via file:// — alguns recursos podem ser limitados pelo navegador.");
    }
  </script>



</body>

</html>